{"ast":null,"code":"import { ArrowLeft } from '@element-plus/icons-vue';\nimport request from \"@/utils/request\";\nimport * as echarts from \"echarts\";\nexport default {\n  name: \"TeacherGrade\",\n\n  data() {\n    return {\n      ArrowLeft,\n      courseId: sessionStorage.getItem(\"currentCourse\"),\n      courseName: sessionStorage.getItem(\"currentCourseName\"),\n      teacherId: sessionStorage.getItem(\"currentId\"),\n      teacherName: sessionStorage.getItem(\"currentName\"),\n      term: sessionStorage.getItem(\"currentTerm\"),\n      time: sessionStorage.getItem(\"currentTime\"),\n      credit: sessionStorage.getItem(\"currentCredit\"),\n      limitNum: sessionStorage.getItem(\"currentLimitNum\"),\n      currentNum: sessionStorage.getItem(\"currentCurrentNum\"),\n      tableData: [],\n      dialogVisible: false,\n      form: {},\n      dialogVisible2: false,\n      form2: {},\n      title: \"\",\n      // 用于录入平时成绩和期末成绩暂存当前字段\n      row: {},\n      // 当前总成绩是否需要更新\n      needToUpdate: false,\n      // 成绩展示\n      dialogVisible3: false,\n      usualAverage: 0,\n      finalAverage: 0,\n      totalAverage: 0\n    };\n  },\n\n  created() {\n    this.load();\n  },\n\n  methods: {\n    load() {\n      request.get(\"/grade/forGrade\", {\n        params: {\n          term: this.term,\n          courseId: this.courseId,\n          teacherId: this.teacherId,\n          time: this.time\n        }\n      }).then(res => {\n        console.log(res);\n        this.tableData = res.data.list;\n        this.total = res.data.total;\n      });\n    },\n\n    handleGrade(row) {\n      this.form.usualGrade = row.usualGrade;\n      this.form.finalGrade = row.finalGrade;\n      this.title = row.id + \"-\" + row.name + \"的成绩信息\";\n      this.row.studentId = row.id;\n      this.row.teacherId = this.teacherId;\n      this.row.courseId = this.courseId;\n      this.row.term = this.term;\n      this.row.time = this.time;\n      this.dialogVisible = true;\n    },\n\n    save() {\n      this.row.usualGrade = this.form.usualGrade;\n      this.row.finalGrade = this.form.finalGrade;\n      console.log(this.row);\n      request.post(\"/grade/logging\", this.row).then(res => {\n        console.log(res);\n\n        if (res.code === '0') {\n          this.$message({\n            type: 'success',\n            message: '成绩更新成功'\n          });\n          this.load();\n          this.dialogVisible = false;\n          this.needToUpdate = true;\n        } else {\n          this.$message({\n            type: 'error',\n            message: res.msg\n          });\n        }\n      });\n    },\n\n    getTotalGrade() {\n      // 此处可以保留上次输入的数据\n      // this.form2 = {};\n      this.dialogVisible2 = true;\n    },\n\n    back() {\n      if (this.needToUpdate) {\n        this.$message({\n          type: 'warning',\n          message: '综合成绩未更新'\n        });\n        return;\n      } else {\n        this.$router.push('/teacherCurriculum');\n      }\n    },\n\n    update() {\n      if (eval(this.form2.usualGradeProportion + \"+\" + this.form2.finalGradeProportion) !== 100) {\n        this.$message({\n          type: \"warning\",\n          message: \"数据不合法，请重新输入\"\n        });\n        this.form2 = {};\n        return;\n      }\n\n      request.get(\"/grade/update\", {\n        params: {\n          term: this.term,\n          courseId: this.courseId,\n          teacherId: this.teacherId,\n          time: this.time,\n          usualGradeProportion: this.form2.usualGradeProportion * 0.01,\n          finalGradeProportion: this.form2.finalGradeProportion * 0.01\n        }\n      }).then(res => {\n        console.log(res);\n\n        if (res.code === '0') {\n          this.$message({\n            type: 'success',\n            message: '综合成绩更新成功'\n          });\n          this.needToUpdate = false;\n          this.load();\n          this.dialogVisible2 = false;\n        } else {\n          this.$message({\n            type: 'error',\n            message: res.msg\n          });\n        }\n      });\n    },\n\n    displayGrade() {\n      if (this.tableData.length === 0) {\n        this.$message({\n          type: \"warning\",\n          message: \"暂无学生选课\"\n        });\n        return;\n      }\n\n      let usualDistributionData = [{\n        value: 0,\n        name: '90分-100分'\n      }, {\n        value: 0,\n        name: '80分-89分'\n      }, {\n        value: 0,\n        name: '70分-79分'\n      }, {\n        value: 0,\n        name: '60-69分'\n      }, {\n        value: 0,\n        name: '60分以下'\n      }];\n      let finalDistributionData = JSON.parse(JSON.stringify(usualDistributionData));\n      let totalDistributionData = JSON.parse(JSON.stringify(usualDistributionData));\n      this.initDistributionData(usualDistributionData, 1);\n      this.initDistributionData(finalDistributionData, 2);\n      this.initDistributionData(totalDistributionData, 3);\n      this.dialogVisible3 = true;\n      this.$nextTick(() => {\n        let myChart = echarts.init(document.getElementById(\"usualDistribution\"));\n        let myChart2 = echarts.init(document.getElementById(\"finalDistribution\"));\n        let myChart3 = echarts.init(document.getElementById(\"totalDistribution\"));\n        let option = {\n          title: {\n            text: '平时成绩',\n            left: 'center'\n          },\n          tooltip: {\n            trigger: 'item'\n          },\n          legend: {\n            top: '5%',\n            left: 'center'\n          },\n          series: [{\n            name: '该分数段人数',\n            type: 'pie',\n            radius: ['40%', '70%'],\n            avoidLabelOverlap: false,\n            itemStyle: {\n              borderRadius: 10,\n              borderColor: '#fff',\n              borderWidth: 2\n            },\n            label: {\n              show: false,\n              position: 'center'\n            },\n            emphasis: {\n              label: {\n                show: true,\n                fontSize: '40',\n                fontWeight: 'bold'\n              }\n            },\n            labelLine: {\n              show: false\n            },\n            data: usualDistributionData\n          }]\n        };\n        myChart.setOption(option);\n        let option2 = JSON.parse(JSON.stringify(option));\n        option2.title.text = \"考试成绩\";\n        option2.series[0].data = finalDistributionData;\n        myChart2.setOption(option2);\n        let option3 = JSON.parse(JSON.stringify(option));\n        option3.title.text = \"综合成绩\";\n        option3.series[0].data = totalDistributionData;\n        myChart3.setOption(option3); // 算平均分\n\n        let usualSum = 0,\n            finalSum = 0,\n            totalSum = 0;\n\n        for (let i = 0; i < this.tableData.length; i++) {\n          usualSum += this.tableData[i].usualGrade;\n          finalSum += this.tableData[i].finalGrade;\n          totalSum += this.tableData[i].totalGrade;\n        }\n\n        console.log(usualSum);\n        console.log(finalSum);\n        console.log(totalSum);\n        this.usualAverage = (usualSum / this.tableData.length).toFixed(2);\n        this.finalAverage = (finalSum / this.tableData.length).toFixed(2);\n        this.totalAverage = (totalSum / this.tableData.length).toFixed(2);\n      });\n    },\n\n    initDistributionData(distributionData, which) {\n      let t;\n\n      for (let i = 0; i < this.tableData.length; i++) {\n        if (which === 1) {\n          t = this.tableData[i].usualGrade;\n        } else if (which === 2) {\n          t = this.tableData[i].finalGrade;\n        } else {\n          t = this.tableData[i].totalGrade;\n        }\n\n        if (t >= 90 && t <= 100) {\n          distributionData[0][\"value\"]++;\n        } else if (t >= 80 && t <= 89) {\n          distributionData[1][\"value\"]++;\n        } else if (t >= 70 && t <= 79) {\n          distributionData[2][\"value\"]++;\n        } else if (t >= 60 && t <= 69) {\n          distributionData[3][\"value\"]++;\n        } else {\n          distributionData[4][\"value\"]++;\n        }\n      }\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["ArrowLeft","request","echarts","name","data","courseId","sessionStorage","getItem","courseName","teacherId","teacherName","term","time","credit","limitNum","currentNum","tableData","dialogVisible","form","dialogVisible2","form2","title","row","needToUpdate","dialogVisible3","usualAverage","finalAverage","totalAverage","created","load","methods","get","params","then","res","console","log","list","total","handleGrade","usualGrade","finalGrade","id","studentId","save","post","code","$message","type","message","msg","getTotalGrade","back","$router","push","update","eval","usualGradeProportion","finalGradeProportion","displayGrade","length","usualDistributionData","value","finalDistributionData","JSON","parse","stringify","totalDistributionData","initDistributionData","$nextTick","myChart","init","document","getElementById","myChart2","myChart3","option","text","left","tooltip","trigger","legend","top","series","radius","avoidLabelOverlap","itemStyle","borderRadius","borderColor","borderWidth","label","show","position","emphasis","fontSize","fontWeight","labelLine","setOption","option2","option3","usualSum","finalSum","totalSum","i","totalGrade","toFixed","distributionData","which","t"],"sourceRoot":"","sources":["E:\\code\\springboot+vue\\class_choose\\src\\views\\TeacherGrade.vue"],"sourcesContent":["<template>\n  <div style=\"margin: 10px;\">\n    <el-button type=\"primary\" plain :icon=\"ArrowLeft\"\n               @click=\"back\">返回课程列表\n    </el-button>\n    <el-button type=\"primary\" plain @click=\"displayGrade\">查看成绩分布\n    </el-button>\n    <div style=\"text-align: center;\">\n      <h1 style=\"color: #409EFF;\">学生名单</h1>\n      <span>\n        课程号：<ins>&nbsp;{{ courseId }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n        课程名：<ins>&nbsp;{{ courseName }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n        学期：<ins>&nbsp;{{ term }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n        <br><br>\n        学分：<ins>&nbsp;{{ credit }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n        教师号：<ins>&nbsp;{{ teacherId }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n        教师名：<ins>&nbsp;{{ teacherName }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n        时间：<ins>&nbsp;{{ time }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n        <br><br>\n        选课人数上限：<ins>&nbsp;{{ limitNum }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n        当前选课人数：<ins>&nbsp;{{ currentNum }}&nbsp;</ins>\n      </span>\n      <hr>\n\n      <!--表格-->\n      <el-table :data=\"tableData\" border stripe style=\"width: 100%;\">\n        <el-table-column prop=\"id\" label=\"学生学号\" sortable/>\n        <el-table-column prop=\"name\" label=\"学生姓名\"/>\n        <el-table-column prop=\"usualGrade\" label=\"平时成绩\" sortable/>\n        <el-table-column prop=\"finalGrade\" label=\"考试成绩\" sortable/>\n        <el-table-column prop=\"totalGrade\" label=\"综合成绩\" sortable/>\n\n        <el-table-column fixed=\"right\" label=\"操作\" width=\"120\">\n          <template #default=\"scope\">\n            <el-button type=\"text\" size=\"small\" @click=\"handleGrade(scope.row)\">编辑成绩</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </div>\n\n    <el-row>\n      <el-col :span=\"16\">\n        <div style=\"margin: 10px 10px 10px; font-size: 10px; color: rgb(96, 98, 102);\">选课人数：{{ currentNum }}</div>\n      </el-col>\n      <el-col :span=\"4\">\n        <div style=\"margin-top: 15px; margin-left: 20px; color: red;\" v-if=\"needToUpdate\">请更新综合成绩！</div>\n      </el-col>\n      <el-col :span=\"4\">\n        <el-button style=\"margin: 10px;\" type=\"primary\" plain @click=\"getTotalGrade\">生成综合成绩</el-button>\n      </el-col>\n    </el-row>\n\n    <el-dialog v-model=\"dialogVisible\" :title=\"title\" width=\"30%\">\n      <el-form :model=\"form\" label-width=\"120px\">\n        <el-form-item label=\"平时成绩\">\n          <el-input v-model=\"form.usualGrade\" style=\"width: 80%;\"/>\n        </el-form-item>\n        <el-form-item label=\"考试成绩\">\n          <el-input v-model=\"form.finalGrade\" style=\"width: 80%;\"/>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n      <span>\n        <el-button @click=\"dialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"save\">确 定</el-button>\n      </span>\n      </template>\n    </el-dialog>\n\n    <el-dialog v-model=\"dialogVisible2\" title=\"请输入平时分和考试分占比\" width=\"30%\">\n      <el-form :model=\"form2\" label-width=\"120px\">\n        <el-form-item label=\"平时成绩占比\">\n          <el-input v-model=\"form2.usualGradeProportion\" style=\"width: 40%;\"/>\n          <span>&nbsp;&nbsp;%</span>\n        </el-form-item>\n        <el-form-item label=\"考试成绩占比\">\n          <el-input v-model=\"form2.finalGradeProportion\" style=\"width: 40%;\"/>\n          <span>&nbsp;&nbsp;%</span>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n      <span>\n        <el-button @click=\"dialogVisible2 = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"update\">确 定</el-button>\n      </span>\n      </template>\n    </el-dialog>\n\n    <el-dialog v-model=\"dialogVisible3\" width=\"80%\" title=\"成绩分布\">\n      <el-row>\n        <el-col :span=\"8\" style=\"height: 500px;\" id=\"usualDistribution\"></el-col>\n        <el-col :span=\"8\" style=\"height: 500px;\" id=\"finalDistribution\"></el-col>\n        <el-col :span=\"8\" style=\"height: 500px;\" id=\"totalDistribution\"></el-col>\n      </el-row>\n      <el-row>\n        <el-col :span=\"8\" style=\"height: 30px; font-weight:bold; text-align: center;\">平均分：{{ usualAverage }}</el-col>\n        <el-col :span=\"8\" style=\"height: 30px; font-weight:bold; text-align: center;\">平均分：{{ finalAverage }}</el-col>\n        <el-col :span=\"8\" style=\"height: 30px; font-weight:bold; text-align: center;\">平均分：{{ totalAverage }}</el-col>\n      </el-row>\n    </el-dialog>\n\n  </div>\n</template>\n\n<script>\nimport {ArrowLeft} from '@element-plus/icons-vue'\nimport request from \"@/utils/request\";\nimport * as echarts from \"echarts\";\n\nexport default {\n  name: \"TeacherGrade\",\n  data() {\n    return {\n      ArrowLeft,\n      courseId: sessionStorage.getItem(\"currentCourse\"),\n      courseName: sessionStorage.getItem(\"currentCourseName\"),\n      teacherId: sessionStorage.getItem(\"currentId\"),\n      teacherName: sessionStorage.getItem(\"currentName\"),\n      term: sessionStorage.getItem(\"currentTerm\"),\n      time: sessionStorage.getItem(\"currentTime\"),\n      credit: sessionStorage.getItem(\"currentCredit\"),\n      limitNum: sessionStorage.getItem(\"currentLimitNum\"),\n      currentNum: sessionStorage.getItem(\"currentCurrentNum\"),\n\n      tableData: [],\n\n      dialogVisible: false,\n      form: {},\n      dialogVisible2: false,\n      form2: {},\n      title: \"\",\n\n      // 用于录入平时成绩和期末成绩暂存当前字段\n      row: {},\n\n      // 当前总成绩是否需要更新\n      needToUpdate: false,\n\n      // 成绩展示\n      dialogVisible3: false,\n      usualAverage: 0,\n      finalAverage: 0,\n      totalAverage: 0\n    }\n  },\n  created() {\n    this.load();\n  },\n  methods: {\n    load() {\n      request.get(\"/grade/forGrade\", {\n        params: {\n          term: this.term,\n          courseId: this.courseId,\n          teacherId: this.teacherId,\n          time: this.time\n        }\n      }).then(res => {\n        console.log(res);\n        this.tableData = res.data.list;\n        this.total = res.data.total;\n      })\n    },\n    handleGrade(row) {\n      this.form.usualGrade = row.usualGrade;\n      this.form.finalGrade = row.finalGrade;\n      this.title = row.id + \"-\" + row.name + \"的成绩信息\";\n\n      this.row.studentId = row.id;\n      this.row.teacherId = this.teacherId;\n      this.row.courseId = this.courseId;\n      this.row.term = this.term;\n      this.row.time = this.time;\n      this.dialogVisible = true;\n    },\n    save() {\n      this.row.usualGrade = this.form.usualGrade;\n      this.row.finalGrade = this.form.finalGrade;\n      console.log(this.row)\n      request.post(\"/grade/logging\", this.row).then(res => {\n        console.log(res);\n        if (res.code === '0') {\n          this.$message({\n            type: 'success',\n            message: '成绩更新成功'\n          })\n          this.load();\n          this.dialogVisible = false;\n          this.needToUpdate = true;\n        } else {\n          this.$message({\n            type: 'error',\n            message: res.msg\n          })\n        }\n      })\n    },\n    getTotalGrade() {\n      // 此处可以保留上次输入的数据\n      // this.form2 = {};\n      this.dialogVisible2 = true;\n    },\n    back() {\n      if (this.needToUpdate) {\n        this.$message({\n          type: 'warning',\n          message: '综合成绩未更新'\n        })\n        return;\n      } else {\n        this.$router.push('/teacherCurriculum');\n      }\n    },\n    update() {\n      if (eval(this.form2.usualGradeProportion + \"+\" + this.form2.finalGradeProportion) !== 100) {\n        this.$message({\n          type: \"warning\",\n          message: \"数据不合法，请重新输入\"\n        })\n        this.form2 = {};\n        return;\n      }\n      request.get(\"/grade/update\", {\n        params: {\n          term: this.term,\n          courseId: this.courseId,\n          teacherId: this.teacherId,\n          time: this.time,\n          usualGradeProportion: this.form2.usualGradeProportion * 0.01,\n          finalGradeProportion: this.form2.finalGradeProportion * 0.01\n        }\n      }).then(res => {\n        console.log(res);\n        if (res.code === '0') {\n          this.$message({\n            type: 'success',\n            message: '综合成绩更新成功'\n          })\n          this.needToUpdate = false;\n          this.load();\n          this.dialogVisible2 = false;\n        } else {\n          this.$message({\n            type: 'error',\n            message: res.msg\n          })\n        }\n      })\n    },\n    displayGrade() {\n      if (this.tableData.length === 0) {\n        this.$message({\n          type: \"warning\",\n          message: \"暂无学生选课\"\n        })\n        return;\n      }\n      let usualDistributionData = [\n        {value: 0, name: '90分-100分'},\n        {value: 0, name: '80分-89分'},\n        {value: 0, name: '70分-79分'},\n        {value: 0, name: '60-69分'},\n        {value: 0, name: '60分以下'}\n      ];\n      let finalDistributionData = JSON.parse(JSON.stringify(usualDistributionData));\n      let totalDistributionData = JSON.parse(JSON.stringify(usualDistributionData));\n      this.initDistributionData(usualDistributionData, 1);\n      this.initDistributionData(finalDistributionData, 2);\n      this.initDistributionData(totalDistributionData, 3);\n      this.dialogVisible3 = true;\n      this.$nextTick(() => {\n        let myChart = echarts.init(document.getElementById(\"usualDistribution\"));\n        let myChart2 = echarts.init(document.getElementById(\"finalDistribution\"));\n        let myChart3 = echarts.init(document.getElementById(\"totalDistribution\"));\n        let option = {\n          title: {\n            text: '平时成绩',\n            left: 'center'\n          },\n          tooltip: {\n            trigger: 'item'\n          },\n          legend: {\n            top: '5%',\n            left: 'center'\n          },\n          series: [\n            {\n              name: '该分数段人数',\n              type: 'pie',\n              radius: ['40%', '70%'],\n              avoidLabelOverlap: false,\n              itemStyle: {\n                borderRadius: 10,\n                borderColor: '#fff',\n                borderWidth: 2\n              },\n              label: {\n                show: false,\n                position: 'center'\n              },\n              emphasis: {\n                label: {\n                  show: true,\n                  fontSize: '40',\n                  fontWeight: 'bold'\n                }\n              },\n              labelLine: {\n                show: false\n              },\n              data: usualDistributionData\n            }\n          ]\n        };\n        myChart.setOption(option);\n\n        let option2 = JSON.parse(JSON.stringify(option));\n        option2.title.text = \"考试成绩\"\n        option2.series[0].data = finalDistributionData;\n        myChart2.setOption(option2);\n\n        let option3 = JSON.parse(JSON.stringify(option));\n        option3.title.text = \"综合成绩\"\n        option3.series[0].data = totalDistributionData;\n        myChart3.setOption(option3);\n\n        // 算平均分\n        let usualSum = 0, finalSum = 0, totalSum = 0;\n        for (let i = 0; i < this.tableData.length; i++) {\n          usualSum += this.tableData[i].usualGrade;\n          finalSum += this.tableData[i].finalGrade;\n          totalSum += this.tableData[i].totalGrade;\n        }\n        console.log(usualSum)\n        console.log(finalSum)\n        console.log(totalSum)\n        this.usualAverage = (usualSum / this.tableData.length).toFixed(2);\n        this.finalAverage = (finalSum / this.tableData.length).toFixed(2);\n        this.totalAverage = (totalSum / this.tableData.length).toFixed(2);\n      })\n    },\n    initDistributionData(distributionData, which) {\n      let t;\n      for (let i = 0; i < this.tableData.length; i++) {\n        if (which === 1) {\n          t = this.tableData[i].usualGrade\n        } else if (which === 2) {\n          t = this.tableData[i].finalGrade\n        } else {\n          t = this.tableData[i].totalGrade\n        }\n        if (t >= 90 && t <= 100) {\n          distributionData[0][\"value\"]++;\n        } else if (t >= 80 && t <= 89) {\n          distributionData[1][\"value\"]++;\n        } else if (t >= 70 && t <= 79) {\n          distributionData[2][\"value\"]++;\n        } else if (t >= 60 && t <= 69) {\n          distributionData[3][\"value\"]++;\n        } else {\n          distributionData[4][\"value\"]++;\n        }\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n\n</style>"]},"metadata":{},"sourceType":"module"}